# 聊天界面使用指南

## 功能概述

聊天界面是占卜系统的第三阶段实现，提供了更自然的对话交互体验。

## 主要特性

### 1. 双模式支持
- **单次占卜模式**：传统的单次问答模式
- **聊天模式**：支持多轮对话，保持上下文

### 2. 上下文交互
- 记录对话历史
- 支持上下文信息输入
- 智能回复生成

### 3. 聊天历史
- 本地存储聊天记录
- 可视化聊天界面
- 时间戳显示

## 使用方法

### 1. 切换聊天模式
1. 点击页面右上角的"聊天模式"按钮
2. 按钮变为紫色，表示已进入聊天模式
3. 再次点击可退出聊天模式

### 2. 发送消息
1. 在聊天模式下，输入你的问题
2. 可选择性地添加上下文信息
3. 点击"发送消息"按钮
4. AI会根据上下文生成回复

### 3. 查看聊天历史
1. 在聊天模式下，所有对话都会记录
2. 聊天历史显示在占卜结果下方
3. 每条消息都有时间戳标记

## 技术实现

### 后端
- **ModelScopeService**：支持上下文交互的占卜服务
- **路由**：新增 `/fortune/chat` 聊天接口
- **数据存储**：内存存储对话历史

### 前端
- **FortunePage**：支持聊天模式的占卜页面
- **ChatHistory**：聊天历史显示组件
- **API服务**：新增聊天接口调用

## API接口

### 聊天接口
```
POST /fortune/chat
Content-Type: application/json

{
  "question": "用户问题",
  "type": "占卜类型",
  "context": "上下文信息（可选）"
}
```

### 响应格式
```json
{
  "prediction": "预测结果",
  "advice": "建议",
  "luckyElements": ["幸运元素"],
  "confidence": 0.9
}
```

## 使用场景

### 1. 深度咨询
- 用户可以就同一问题进行多轮询问
- AI会根据之前的回答提供更深入的分析

### 2. 追问细节
- 用户可以对某个预测结果进行追问
- AI会基于上下文给出更具体的解释

### 3. 情境分析
- 用户可以提供更多背景信息
- AI会结合上下文给出更精准的建议

## 优势特点

### 1. 用户体验
- 更自然的对话交互
- 支持多轮对话
- 上下文记忆功能

### 2. 功能完善
- 聊天历史记录
- 上下文信息支持
- 模式切换便捷

### 3. 技术先进
- 基于大语言模型的对话能力
- 智能上下文处理
- 实时响应机制

## 后续优化

### 1. 数据持久化
- 将聊天历史保存到数据库
- 支持用户登录和个性化存储

### 2. 功能扩展
- 添加表情符号支持
- 支持图片上传
- 语音输入功能

### 3. 性能优化
- 聊天历史分页加载
- 消息缓存机制
- 响应速度优化

## 测试验证

建议通过以下方式验证聊天界面功能：
1. 功能测试：验证聊天模式的正常工作
2. 上下文测试：验证上下文信息的正确传递
3. 历史测试：验证聊天历史的正确显示
4. 性能测试：验证多轮对话的响应速度

## 总结

聊天界面的实现为占卜系统提供了更自然、更智能的交互方式。用户可以通过多轮对话获得更深入、更个性化的占卜服务，大大提升了用户体验和服务的实用性。