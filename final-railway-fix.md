# æœ€ç»ˆ Railway ä¿®å¤æŠ¥å‘Š

## ğŸ” é—®é¢˜æ ¹æœ¬åŸå› 

### ä¸»è¦é—®é¢˜
ä»æ—¥å¿—åˆ†æå¯ä»¥çœ‹å‡ºï¼ŒRailway éƒ¨ç½²çš„ä»ç„¶æ˜¯æ—§çš„ `start-railway-simple.js` æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ–°åˆ›å»ºçš„ `start-railway-fixed.js` æ–‡ä»¶ã€‚

### æ ¹æœ¬åŸå› 
1. **Railway é…ç½®æ–‡ä»¶é”™è¯¯**ï¼šRailway ä½¿ç”¨çš„æ˜¯ `railway.toml` æ–‡ä»¶ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬æ›´æ–°çš„ `railway-backend-only.toml` æ–‡ä»¶
2. **ç«¯å£é…ç½®é”™è¯¯**ï¼šæ—¥å¿—æ˜¾ç¤ºç«¯å£ä¸º 8080ï¼Œè€Œä¸æ˜¯æˆ‘ä»¬é…ç½®çš„ 10000
3. **å¯åŠ¨æ–‡ä»¶é”™è¯¯**ï¼šä»ç„¶ä½¿ç”¨ `start-railway-simple.js` è€Œä¸æ˜¯ `start-railway-fixed.js`

## ğŸ› ï¸ ä¿®å¤æ–¹æ¡ˆ

### 1. æ›´æ–° Railway é…ç½®æ–‡ä»¶
**æ–‡ä»¶**: `railway.toml`
**ä¿®å¤å†…å®¹**:
```toml
[build]
builder = "NIXPACKS"

[deploy]
startCommand = "node start-railway-fixed.js"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 5

[build.nixpacks]
buildCommand = "npm install"
installCommand = "npm install"
startCommand = "node start-railway-fixed.js"

[environments.production]
NODE_ENV = "production"
PORT = "10000"

# å¼ºåˆ¶ä½¿ç”¨ Node.js 18
[build.environment]
NIXPACKS_NODE = "18"
```

### 2. ç¡®ä¿ä½¿ç”¨æ­£ç¡®çš„å¯åŠ¨æ–‡ä»¶
- **æ–‡ä»¶**: `start-railway-fixed.js`
- **åŠŸèƒ½**: åŒ…å«å®Œæ•´çš„ç½‘ç»œè¯·æ±‚é…ç½®å’Œé”™è¯¯å¤„ç†
- **æ”¹è¿›**: 
  - æ·»åŠ äº† 30 ç§’è¶…æ—¶è®¾ç½®
  - ä¼˜åŒ–äº†è¯·æ±‚å¤´é…ç½®
  - å®Œå–„äº†é”™è¯¯å¤„ç†æœºåˆ¶

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. ç­‰å¾… Railway è‡ªåŠ¨éƒ¨ç½²
- Railway åº”è¯¥å·²ç»æ£€æµ‹åˆ°é…ç½®å˜æ›´
- ç­‰å¾… 2-5 åˆ†é’Ÿå®Œæˆéƒ¨ç½²

### 2. éªŒè¯éƒ¨ç½²çŠ¶æ€
```bash
# å¥åº·æ£€æŸ¥
https://your-app.railway.app/health

# ç¯å¢ƒå˜é‡æ£€æŸ¥
https://your-app.railway.app/api/env

# ç«¯å£æ£€æŸ¥ï¼ˆåº”è¯¥æ˜¾ç¤º 10000ï¼‰
```

### 3. æµ‹è¯• AI åŠŸèƒ½
```bash
# æµ‹è¯• AI å åœ
curl -X POST https://your-app.railway.app/api/fortune/chat \
  -H "Content-Type: application/json" \
  -d '{
    "type": "bazi",
    "question": "è¯·åˆ†ææˆ‘çš„å…«å­—å‘½ç†",
    "context": [
      {"type": "user", "content": "æˆ‘çš„å‡ºç”Ÿæ—¥æœŸæ˜¯ 1996.02.10"}
    ],
    "sessionId": "test"
  }'
```

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

ç¡®ä¿ Railway ç¯å¢ƒå˜é‡æ­£ç¡®è®¾ç½®ï¼š
```bash
MODELSCOPE_TOKEN=ms-bf1291c1-c1ed-464c-b8d8-162fdee96180
MODELSCOPE_MODEL_ID=Qwen/Qwen3-235B-A22B-Instruct-2507
NODE_ENV=production
PORT=10000
```

## ğŸ¯ é¢„æœŸç»“æœ

### æˆåŠŸæ—¶
- âœ… å¥åº·æ£€æŸ¥è¿”å› 200
- âœ… ç¯å¢ƒå˜é‡æ£€æŸ¥æ˜¾ç¤º ModelScope å·²é…ç½®
- âœ… ç«¯å£æ˜¾ç¤ºä¸º 10000ï¼ˆè€Œä¸æ˜¯ 8080ï¼‰
- âœ… AI åŠŸèƒ½æµ‹è¯•è¿”å›çœŸå®çš„å…«å­—å‘½ç†åˆ†æ
- âœ… æ—  ENOTFOUND é”™è¯¯

### è°ƒè¯•ä¿¡æ¯
æœåŠ¡å™¨æ—¥å¿—åº”è¯¥æ˜¾ç¤ºï¼š
- ğŸš€ å¼€å§‹è°ƒç”¨ ModelScope API
- âœ… API è°ƒç”¨æˆåŠŸ
- âœ… AI ç”Ÿæˆç»“æœ
- ğŸ¯ æå–çš„å‡ºç”Ÿæ—¥æœŸ

## ğŸš¨ æ•…éšœæ’é™¤

### 1. å¦‚æœä»ç„¶æœ‰ç½‘ç»œé—®é¢˜
1. æ£€æŸ¥ Railway æ§åˆ¶å°çš„æ„å»ºæ—¥å¿—
2. ç¡®è®¤ ModelScope API æœåŠ¡çŠ¶æ€
3. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®

### 2. å¦‚æœ AI åŠŸèƒ½ä¸å·¥ä½œ
1. æ£€æŸ¥æ˜¯å¦ä½¿ç”¨äº† `start-railway-fixed.js`
2. æŸ¥çœ‹ Railway æ—¥å¿—ä¸­çš„é”™è¯¯ä¿¡æ¯
3. ç¡®è®¤ ModelScope Token æ˜¯å¦æœ‰æ•ˆ

### 3. å¦‚æœç«¯å£ä¸æ­£ç¡®
1. ç¡®è®¤ Railway é…ç½®æ–‡ä»¶æ­£ç¡®
2. æ£€æŸ¥ç¯å¢ƒå˜é‡ä¸­çš„ PORT è®¾ç½®
3. ç¡®ä¿ Railway ä½¿ç”¨æ­£ç¡®çš„é…ç½®æ–‡ä»¶

## ğŸ“Š æŠ€æœ¯æ”¹è¿›

| æ–¹é¢ | ä¿®å¤å‰ | ä¿®å¤å |
|------|--------|--------|
| å¯åŠ¨æ–‡ä»¶ | `start-railway-simple.js` | `start-railway-fixed.js` |
| ç«¯å£é…ç½® | 8080 (é»˜è®¤) | 10000 (é…ç½®) |
| ç½‘ç»œè¯·æ±‚ | åŸºç¡€é…ç½® | å®Œæ•´é…ç½® |
| é”™è¯¯å¤„ç† | åŸºç¡€ | å®Œæ•´ |
| è¶…æ—¶è®¾ç½® | æ—  | 30ç§’ |

## ğŸ‰ ä¸‹ä¸€æ­¥

1. **ç­‰å¾… Railway éƒ¨ç½²å®Œæˆ**
2. **æ£€æŸ¥ç«¯å£é…ç½®**ç¡®ä¿æ˜¾ç¤º 10000
3. **æµ‹è¯•ç½‘ç»œè¿æ¥**ç¡®ä¿ ENOTFOUND é”™è¯¯å·²è§£å†³
4. **éªŒè¯ AI åŠŸèƒ½**ç¡®ä¿è¿”å›çœŸå®åˆ†æ

è¿™ä¸ªä¿®å¤åº”è¯¥èƒ½å¤Ÿå½»åº•è§£å†³ Railway éƒ¨ç½²é—®é¢˜ï¼Œå¹¶æä¾›ç¨³å®šçš„ AI å…«å­—å‘½ç†åˆ†æåŠŸèƒ½ã€‚