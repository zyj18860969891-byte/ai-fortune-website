# Railway 后端服务配置
[build]
builder = "NIXPACKS"

[deploy]
startCommand = "npm run build && npm start"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[build.nixpacks]
buildCommand = "cd backend && npm install && npm run build"
installCommand = "cd backend && npm install"
startCommand = "cd backend && npm start"

[environments.production]
NODE_ENV = "production"
PORT = "3001"
RAILWAY_ENVIRONMENT = "production"

# 强制使用 Node.js 18 和指定端口
[build.environment]
NIXPACKS_NODE = "18"
PORT = "3001"

# 优化 Railway 部署性能
[build.nixpacks.layers]
node = "node:18"
npm = "npm:latest"

# 增加构建超时时间
[build.nixpacks.build]
timeout = 1800  # 30分钟构建超时

# 优化启动超时
[deploy.healthcheck]
path = "/health"
interval = 30
timeout = 10
retries = 3
start_period = 60