[build]
builder = "NIXPACKS"

[build.nixpacks]
buildCommand = "npm install && cd backend && npm run build"
installCommand = "npm install"
startCommand = "cd backend && npm run build && node dist/server.js"

[deploy]
startCommand = "cd backend && npm run build && node dist/server.js"

[engine]
type = "free"

[env]
PORT = "8080"
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 3

[healthcheck]
healthcheckPath = "/health"
healthcheckTimeout = 60
healthcheckInterval = 15
healthcheckUnhealthyThreshold = 2

[environments.production]
NODE_ENV = "production"
# ModelScope配置
MODELSCOPE_API_KEY = "ms-bf1291c1-c1ed-464c-b8d8-162fdee96180"
MODELSCOPE_MODEL = "Qwen/Qwen3-235B-A22B-Instruct-2507"
MODELSCOPE_BASE_URL = "https://api-inference.modelscope.cn/v1"
# MCP服务配置
BAZI_MCP_URL = "https://mcp.api-inference.modelscope.net/6a57768488dc47/mcp"
BAZI_MCP_TIMEOUT = "15000"

# 强制使用 Node.js 18
[build.environment]
NIXPACKS_NODE = "18"
